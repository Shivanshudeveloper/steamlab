(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[49],{6126:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/stlfiles",function(){return t(5607)}])},5607:function(e,n,t){"use strict";t.r(n);var r=t(8520),i=t.n(r),o=t(5893),a=t(9008),c=t(7948),l=(t(2873),t(2379),t(3536)),s=(t(5102),t(7294)),u=t(7906),d=t(295),h=t(3252),f=t(2882),p=t(3184),x=t(3816),g=t(5113),v=t(1057),j=t(9586),m=t(657),y=t(1425),Z=t(6580),b=t(7645),F=t(2474),w=t(5162),S=t(9058),_=t(9123),C=t(7918),E=t(8456),k=t(9669),D=t.n(k),z=t(7035),O=t(8977);function T(e,n,t,r,i,o,a){try{var c=e[o](a),l=c.value}catch(s){return void t(s)}c.done?n(l):Promise.resolve(l).then(r,i)}function I(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function P(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{},r=Object.keys(t);"function"===typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(t).filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})))),r.forEach((function(n){I(e,n,t[n])}))}return e}function A(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=[],r=!0,i=!1,o=void 0;try{for(var a,c=e[Symbol.iterator]();!(r=(a=c.next()).done)&&(t.push(a.value),!n||t.length!==n);r=!0);}catch(l){i=!0,o=l}finally{try{r||null==c.return||c.return()}finally{if(i)throw o}}return t}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function R(e){return function(e){if(Array.isArray(e)){for(var n=0,t=new Array(e.length);n<e.length;n++)t[n]=e[n];return t}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var L=function(e){var n=e.product,t=e.deleteItem;return(0,o.jsx)(o.Fragment,{children:(0,o.jsxs)(x.Z,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[(0,o.jsx)(h.Z,{component:"th",scope:"row",children:n.name}),(0,o.jsx)(h.Z,{align:"center",children:n.cut}),(0,o.jsx)(h.Z,{align:"center",children:n.content}),(0,o.jsx)(h.Z,{align:"center",children:n.uploaded_to}),(0,o.jsx)(h.Z,{align:"center",children:"Received"===n.status?(0,o.jsx)(C.Z,{sx:{backgroundColor:"#FFC311",color:"#FFFFFF"},label:"A re\xe7u"}):"In process"===n.status?(0,o.jsx)(C.Z,{sx:{backgroundColor:"#3366FF",color:"#FFFFFF"},label:"En cours"}):"Delivered"===n.status?(0,o.jsx)(C.Z,{sx:{backgroundColor:"#D14343",color:"#FFFFFF"},label:"Livr\xe9"}):"Invoiced"===n.status?(0,o.jsx)(C.Z,{sx:{backgroundColor:"#FFB020",color:"#FFFFFF"},label:"Factur\xe9"}):null}),(0,o.jsx)(h.Z,{align:"center",children:n.reception}),(0,o.jsx)(h.Z,{align:"center",children:n.delivery_date}),(0,o.jsxs)(h.Z,{align:"center",children:[(0,o.jsx)(v.Z,{variant:"contained",href:n.publicURL,target:"_blank",children:"Download"}),(0,o.jsx)(v.Z,{color:"error",onClick:function(){return t(n._id)},sx:{ml:2},children:"Delete"})]})]},n._id)})},N=function(){var e=(0,w.uI)(),n=e.acceptedFiles,t=e.getRootProps,r=e.getInputProps,l=A(s.useState([]),2),C=l[0],k=l[1],I=A(s.useState(!1),2),N=I[0],W=I[1],q=A(s.useState({}),2),U=q[0],V=q[1],B=A(s.useState(!0),2),G=B[0],H=B[1];s.useEffect((function(){var e=sessionStorage.getItem("userEmail");z.I8.onAuthStateChanged((function(e){e&&V(e)})),D().get("".concat(O.V,"/api/v1/main/getuserfileuploadedtoserver/").concat(e)).then((function(e){k(e.data),H(!1)})).catch((function(e){return console.log(e)}))}),[]);var M=function(){var e=sessionStorage.getItem("userEmail");H(!0),D().get("".concat(O.V,"/api/v1/main/getuserfileuploadedtoserver/").concat(e)).then((function(e){k(e.data),H(!1)})).catch((function(e){return console.log(e)}))},X=A(s.useState((new Date).toLocaleDateString()),2),Q=X[0],J=X[1],K=function(){W(!1)},Y=n.map((function(e){return(0,o.jsxs)("li",{children:[e.path," - ",e.size," bytes"]},e.path)})),$=A(s.useState(""),2),ee=$[0],ne=$[1],te=A(s.useState([]),2),re=te[0],ie=te[1],oe=A(s.useState(!1),2),ae=oe[0],ce=oe[1],le=A(s.useState(""),2),se=le[0],ue=le[1],de=A(s.useState(""),2),he=de[0],fe=de[1],pe=function(){n.forEach((function(e){var n,t=e.name.split(".").pop();if("zip"===t||"rar"===t){var r=(0,S.Z)(),o=z.tO.ref("uploadsfiles/".concat(r,"/").concat(e.name)).put(e);o.on("state_changed",(function(e){var n=Math.round(e.bytesTransferred/e.totalBytes*100);ce(!0),ue("Uploaded ".concat(Math.floor(n),"%"))}),(function(e){ue(e)}),(n=i().mark((function n(){var t,r,a;return i().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=(0,_.Z)(e.size),t="".concat(t.value," ").concat(t.unit),n.next=4,o.snapshot.ref.getDownloadURL();case 4:r=n.sent,a={useremail:U.email,userfullname:U.displayName,userphone:he,name:e.path,cut:t,content:e.type,uploaded_to:(new Date).toLocaleDateString(),status:"Received",reception:ee,delivery_date:Q,publicURL:r},D().post("".concat(O.V,"/api/v1/main/addfileuploadtoserver"),a).then((function(e){200===e.status&&(ce(!0),ue("File Successfully Send"),M(),setInterval((function(){ce(!1)}),4e3))})).catch((function(e){return console.log(e)}));case 7:case"end":return n.stop()}}),n)})),function(){var e=this,t=arguments;return new Promise((function(r,i){var o=n.apply(e,t);function a(e){T(o,r,i,a,c,"next",e)}function c(e){T(o,r,i,a,c,"throw",e)}a(void 0)}))}))}else alert("Only ZIP and RAR Files are allowed, Cannot upload ".concat(e.name))}))},xe=function(e){D().get("".concat(O.V,"/api/v1/main/deletefileuploadtouser/").concat(e)).then((function(e){ce(!0),ue("Successfully Removed"),M(),K()})).catch((function(e){return console.log(e)}))};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(j.Z,{open:ae,autoHideDuration:6e3,message:se,onClose:function(){ce(!1)}}),(0,o.jsxs)(m.Z,{open:N,fullWidth:!0,maxWidth:"md",onClose:K,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[(0,o.jsx)(b.Z,{id:"alert-dialog-title",children:"Pensez \xe0 zipper vos commandes avant envoi"}),(0,o.jsx)(Z.Z,{children:(0,o.jsxs)(c.Z,{children:[(0,o.jsxs)("section",P({className:"dropzone"},t(),{children:[(0,o.jsxs)("div",{children:[(0,o.jsx)("input",P({},r())),(0,o.jsx)("p",{children:"Glissez vos fichiers ici, ou cliquez pour s\xe9lectionner un fichier"})]}),(0,o.jsxs)("aside",{children:[(0,o.jsx)("h4",{children:"Files"}),(0,o.jsx)("ul",{children:Y})]})]})),(0,o.jsx)(F.Z,{id:"outlined-multiline-static",fullWidth:!0,label:"Entrez la description...",multiline:!0,rows:6,sx:{mt:2},value:ee,onChange:function(e){ne(e.target.value)}}),(0,o.jsx)("h4",{style:{marginTop:"1rem"},children:"Quand en avez-vous besoin?"}),(0,o.jsx)(F.Z,{required:!0,id:"outlined-required",type:"date",fullWidth:!0,sx:{mt:2},onChange:function(e){J(e.target.value)}}),(0,o.jsx)(F.Z,{required:!0,label:"Num\xe9ro de t\xe9l\xe9phone",id:"outlined-required",fullWidth:!0,sx:{mt:2},onChange:function(e){return fe(e.target.value)}})]})}),(0,o.jsxs)(y.Z,{children:[(0,o.jsx)(v.Z,{size:"large",onClick:K,children:"Fermer"}),(0,o.jsx)(v.Z,{size:"large",onClick:function(){pe();var e=R(re);for(n.forEach((function(n){var t,r,i,o,a=(0,_.Z)(n.size);a="".concat(a.value," ").concat(a.unit),e.push((t=n.path,r=a,i=n.type,o=(new Date).toLocaleDateString(),{name:t,cut:r,contentType:i,uploadedTo:o,status:"Received",desiredReception:ee,date:Q}))})),ie(e);n.length>0;)n.pop();ne(""),K()},autoFocus:!0,children:"Envoyer"})]})]}),(0,o.jsx)(a.default,{children:(0,o.jsx)("title",{children:"STL Files Upload"})}),(0,o.jsxs)(c.Z,{maxWidth:"xl",component:"main",sx:{flexGrow:1,py:8},children:[(0,o.jsx)(v.Z,{sx:{float:"right",mb:8},onClick:function(){W(!0)},variant:"contained",size:"large",children:"Envoyer un Fichier STL"}),(0,o.jsx)("h1",{style:{marginTop:"45px"},children:"Historique des envois"}),!0===G?(0,o.jsx)("center",{style:{marginTop:"8%"},children:(0,o.jsx)(E.Z,{color:"primary"})}):(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(f.Z,{component:g.Z,children:(0,o.jsxs)(u.Z,{sx:{minWidth:650},"aria-label":"simple table",children:[(0,o.jsx)(p.Z,{children:(0,o.jsxs)(x.Z,{children:[(0,o.jsx)(h.Z,{children:"Nom"}),(0,o.jsx)(h.Z,{align:"center",children:"Taille"}),(0,o.jsx)(h.Z,{align:"center",children:"Type de contenu"}),(0,o.jsx)(h.Z,{align:"center",children:"Charg\xe9 le"}),(0,o.jsx)(h.Z,{align:"center",children:"Satut"}),(0,o.jsx)(h.Z,{align:"center",children:"Date de r\xe9ception"}),(0,o.jsx)(h.Z,{align:"center",children:"Date de livraison"}),(0,o.jsx)(h.Z,{align:"center",children:"Action"})]})}),(0,o.jsx)(d.Z,{children:C.map((function(e){return(0,o.jsx)(L,{product:e,deleteItem:xe},e._id)}))})]})})})]})]})};N.getLayout=function(e){return(0,o.jsx)(l.c,{children:e})},n.default=N}},function(e){e.O(0,[883,775,239,63,650,474,432,585,586,538,536,923,774,888,179],(function(){return n=6126,e(e.s=n);var n}));var n=e.O();_N_E=n}]);